<!--
/*
    Loading
*/

function createXMLObject()
{
  if (window.XMLHttpRequest) // Firefox
    xml = new XMLHttpRequest();
  else if (window.ActiveXObject) // Internet Explorer
    xml = new ActiveXObject("Microsoft.XMLHTTP");
  else
  {
    // XMLHttpRequest not supported
    xml = null;
  }
  return xml;
}
var currentXMLObject = false;
var currentTranslateXMLObject = false;

function loadEditMode()
{
  currentXMLObject = createXMLObject();

  if (currentXMLObject)
  {
    url = "jgetSource";

    currentXMLObject.open("POST", url, true);
    currentXMLObject.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    currentXMLObject.onreadystatechange = loadEditModeResult;
    currentXMLObject.send(null);
  }
  else
  {
    alert("loadEditMode: operation not supported");
  }
}

function loadEditModeResult()
{
  if (currentXMLObject.readyState == 4)
  {
    response = currentXMLObject.responseText;
    node = document.getElementById("wikipageContent");

    var content = new Array();
    content.push('<textarea id="wikipageEditableContent" name="source" rows="30" cols="80"');
    content.push('style="width: 100%; font-family: monospace !important;">');
    content.push(response);
    content.push('</textarea>');
    content = content.join("");

    node.innerHTML = content;

    // change "edit" into "save"
    node = document.getElementById("editButton");
    node.onclick = saveEditMode;
    node.src="wikipage_save.png"
    unWaitProcess();
  }
  else
  {
    if (currentXMLObject.readyState==1)
    {
      // protecting from "double-send" and making screen changes
      waitProcess();
    }
  }
}

/*
    Saving
*/

function saveEditMode()
{
  currentXMLObject = createXMLObject();

  if (currentXMLObject)
  {
    url = "jedit";

    node = document.getElementById("wikipageEditableContent");
    source = node.value;
    var poster = new Array();
    poster.push("source=" + encodeURIComponent(source));
    poster = poster.join("&");

    currentXMLObject.open("POST", url, true);
    currentXMLObject.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    currentXMLObject.onreadystatechange = saveEditModeResult;
    currentXMLObject.send(poster);
  }
  else
  {
    alert("saveEditMode: operation not supported");
  }
}

function saveEditModeResult()
{
  if (currentXMLObject.readyState == 4)
  {
    response = currentXMLObject.responseText;
    reloadWikiPageContent();
    unWaitProcess();
  }
  else
  {

    if (currentXMLObject.readyState==1)
    {
      // protecting from "double-send" and making screen changes
      waitProcess();
    }
  }
}

function reloadWikiPageContentResult()
{
  if (currentXMLObject.readyState == 4)
  {
    response = currentXMLObject.responseText;

    node = document.getElementById("wikipageContent");
    node.innerHTML = response;

    node = document.getElementById("editButton");
    node.onclick = loadEditMode;
    node.src="wikipage_write.png"
  }
}

function reloadWikiPageContent()
{
  currentXMLObject = createXMLObject();

  if (currentXMLObject)
  {
    url = "jrender";
    currentXMLObject.open("POST", url, true);
    currentXMLObject.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    currentXMLObject.onreadystatechange = reloadWikiPageContentResult;
    currentXMLObject.send(null);
  }
  else
  {
    alert("reloadWikiContent: operation not supported");
  }
}


function reloadWikiContentResult()
{
  if (currentXMLObject.readyState == 4)
  {
    response = currentXMLObject.responseText;
    node = document.getElementById("wikiContent");
    node.innerHTML = response;
  }
}

function reloadWikiContent()
{
  currentXMLObject = createXMLObject();

  if (currentXMLObject)
  {
    url = "jrender";
    currentXMLObject.open("POST", url, true);
    currentXMLObject.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    currentXMLObject.onreadystatechange = reloadWikiContentResult;
    currentXMLObject.send(null);
  }
  else
  {
    alert("reloadWikiContent: operation not supported");
  }
}


function seePageAdder()
{
  node = document.getElementById("pageTitle");
  helper = document.getElementById("title_helper");
  title = document.getElementById("title");

  if (node.style.visibility == 'hidden')
  {
    node.style.visibility = 'visible';
    helper.style.visibility = 'visible';
    title.style.visibility = 'visible';
  }
  else
  {
    node.style.visibility = 'hidden';
    helper.style.visibility = 'hidden';
    title.style.visibility = 'hidden';
  }
}

/*
waits for <enter> key to validate the page
*/

function pageAdderkeyDown(event)
{
  if (!event)
    event = window.event;

  switch (event.keyCode)
  {
    case 13:
        input_title = document.getElementById("title");
        input_title.style.visibility = 'visible';
        addPage(input_title.value);
        break;
    default:
        helper = document.getElementById("title_helper");
        helper.style.visibility = 'visible';
        return false;
  }
}


function addPageResult()
{
  if (currentXMLObject.readyState == 4)
  {
    response = currentXMLObject.responseText;

    if (response=="OK")
      reloadWikiContent();
    else
      alert("could not add the page");

    unWaitProcess();
  }
  else
  {
    if (currentXMLObject.readyState==1)
    {
      // protecting from "double-send" and making screen changes
      waitProcess();
    }
  }

}

function addPage(name)
{
  seePageAdder();
  currentXMLObject = createXMLObject();

  if (currentXMLObject)
  {
    url = "jaddPage";
    currentXMLObject.open("POST", url, true);
    currentXMLObject.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    currentXMLObject.onreadystatechange = addPageResult;
    currentXMLObject.send("title=" + encodeURIComponent(name));
  }
  else
  {
    alert("addPage: operation not supported");
  }
}

/*
      Helpers
*/

function waitProcess()
{
  node = document.getElementById("redlite");
  node.style.visibility = 'visible';
}

function unWaitProcess()
{
  node = document.getElementById("redlite");
  node.style.visibility = 'hidden';
}

function setCursor(obj)
{
  if (navigator.appName == "Microsoft Internet Explorer")
  {
    isIE = true;
  }
  else
    isIE = false;

  // Change the mouse cursor to hand or pointer
  if (isIE)
    obj.style.cursor = "hand";
  else
    obj.style.cursor = "pointer";
}

function gotoUrl(dest)
{
  self.location.href = dest;
}

//-->